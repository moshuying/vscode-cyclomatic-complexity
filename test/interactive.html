<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>交互式表单示例 - 中等复杂度</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .form-container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
    }

    .success {
      color: #27ae60;
      font-size: 14px;
      margin-top: 5px;
    }

    .btn {
      background-color: #3498db;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    .btn:hover {
      background-color: #2980b9;
    }

    .btn:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background-color: #ecf0f1;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-fill {
      height: 100%;
      background-color: #3498db;
      width: 0%;
      transition: width 0.3s ease;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 15% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: black;
    }
  </style>
</head>

<body>
  <div class="form-container">
    <h1>用户注册表单</h1>
    <p>请填写以下信息完成注册</p>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <form id="registrationForm" novalidate>
      <div class="form-group">
        <label for="username">用户名 *</label>
        <input type="text" id="username" name="username" required minlength="3" maxlength="20"
          onblur="validateField(this)" oninput="updateProgress()">
        <div class="error" id="usernameError"></div>
      </div>

      <div class="form-group">
        <label for="email">邮箱地址 *</label>
        <input type="email" id="email" name="email" required onblur="validateField(this)" oninput="updateProgress()">
        <div class="error" id="emailError"></div>
      </div>

      <div class="form-group">
        <label for="password">密码 *</label>
        <input type="password" id="password" name="password" required minlength="8" onblur="validateField(this)"
          oninput="updateProgress(); checkPasswordStrength(this.value)">
        <div class="error" id="passwordError"></div>
        <div id="passwordStrength"></div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">确认密码 *</label>
        <input type="password" id="confirmPassword" name="confirmPassword" required onblur="validateField(this)"
          oninput="updateProgress()">
        <div class="error" id="confirmPasswordError"></div>
      </div>

      <div class="form-group">
        <label for="birthDate">出生日期</label>
        <input type="date" id="birthDate" name="birthDate" onchange="validateAge(this.value); updateProgress()">
        <div class="error" id="birthDateError"></div>
      </div>

      <div class="form-group">
        <label for="country">国家/地区</label>
        <select id="country" name="country" onchange="updateProgress()">
          <option value="">请选择...</option>
          <option value="CN">中国</option>
          <option value="US">美国</option>
          <option value="JP">日本</option>
          <option value="KR">韩国</option>
          <option value="other">其他</option>
        </select>
      </div>

      <div class="form-group">
        <label for="bio">个人简介</label>
        <textarea id="bio" name="bio" rows="4" maxlength="500" oninput="updateProgress(); updateCharCount(this)"
          placeholder="请简单介绍一下自己..."></textarea>
        <div id="charCount">0/500</div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="terms" name="terms" required onchange="updateProgress()">
          我同意 <a href="#" onclick="showTerms()">服务条款</a> 和 <a href="#" onclick="showPrivacy()">隐私政策</a>
        </label>
        <div class="error" id="termsError"></div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="newsletter" name="newsletter" onchange="updateProgress()">
          订阅我们的新闻邮件
        </label>
      </div>

      <button type="submit" class="btn" id="submitBtn" disabled>注册</button>
    </form>
  </div>

  <!-- 模态框 -->
  <div id="termsModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('termsModal')">&times;</span>
      <h2>服务条款</h2>
      <p>这里是服务条款的内容...</p>
    </div>
  </div>

  <div id="privacyModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('privacyModal')">&times;</span>
      <h2>隐私政策</h2>
      <p>这里是隐私政策的内容...</p>
    </div>
  </div>

  <script>
    // 表单验证和交互脚本 - 高复杂度 (复杂度: 18+)

    // 验证单个字段 - 中等复杂度 (复杂度: 9)
    function validateField(field) {
      const value = field.value.trim();
      const fieldName = field.name;
      const errorElement = document.getElementById(fieldName + 'Error');
      let isValid = true;
      let errorMessage = '';

      // 清除之前的错误
      errorElement.textContent = '';
      field.style.borderColor = '#ddd';

      if (field.required && !value) {
        errorMessage = '此字段为必填项';
        isValid = false;
      } else if (fieldName === 'username') {
        if (value.length < 3) {
          errorMessage = '用户名至少需要3个字符';
          isValid = false;
        } else if (value.length > 20) {
          errorMessage = '用户名不能超过20个字符';
          isValid = false;
        } else if (!/^[a-zA-Z0-9_]+$/.test(value)) {
          errorMessage = '用户名只能包含字母、数字和下划线';
          isValid = false;
        }
      } else if (fieldName === 'email') {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
          errorMessage = '请输入有效的邮箱地址';
          isValid = false;
        }
      } else if (fieldName === 'password') {
        if (value.length < 8) {
          errorMessage = '密码至少需要8个字符';
          isValid = false;
        } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(value)) {
          errorMessage = '密码必须包含大小写字母和数字';
          isValid = false;
        }
      } else if (fieldName === 'confirmPassword') {
        const password = document.getElementById('password').value;
        if (value !== password) {
          errorMessage = '两次输入的密码不一致';
          isValid = false;
        }
      }

      if (!isValid) {
        errorElement.textContent = errorMessage;
        field.style.borderColor = '#e74c3c';
      } else {
        field.style.borderColor = '#27ae60';
      }

      return isValid;
    }

    // 验证年龄 - 中等复杂度 (复杂度: 5)
    function validateAge(birthDate) {
      const errorElement = document.getElementById('birthDateError');
      const today = new Date();
      const birth = new Date(birthDate);
      const age = today.getFullYear() - birth.getFullYear();
      const monthDiff = today.getMonth() - birth.getMonth();

      errorElement.textContent = '';

      if (birthDate && birth > today) {
        errorElement.textContent = '出生日期不能是未来时间';
        return false;
      } else if (age < 13 || (age === 13 && monthDiff < 0)) {
        errorElement.textContent = '年龄必须满13岁';
        return false;
      } else if (age > 120) {
        errorElement.textContent = '请输入有效的出生日期';
        return false;
      }

      return true;
    }

    // 检查密码强度 - 中等复杂度 (复杂度: 6)
    function checkPasswordStrength(password) {
      const strengthElement = document.getElementById('passwordStrength');
      let strength = 0;
      let strengthText = '';
      let strengthColor = '';

      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password)) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;

      switch (strength) {
        case 0:
        case 1:
          strengthText = '密码强度: 很弱';
          strengthColor = '#e74c3c';
          break;
        case 2:
          strengthText = '密码强度: 弱';
          strengthColor = '#f39c12';
          break;
        case 3:
          strengthText = '密码强度: 中等';
          strengthColor = '#f1c40f';
          break;
        case 4:
          strengthText = '密码强度: 强';
          strengthColor = '#27ae60';
          break;
        case 5:
          strengthText = '密码强度: 很强';
          strengthColor = '#16a085';
          break;
      }

      strengthElement.textContent = strengthText;
      strengthElement.style.color = strengthColor;
    }

    // 更新进度条 - 中等复杂度 (复杂度: 7)
    function updateProgress() {
      const requiredFields = ['username', 'email', 'password', 'confirmPassword'];
      const optionalFields = ['birthDate', 'country', 'bio'];
      const checkboxes = ['terms', 'newsletter'];

      let completed = 0;
      let total = requiredFields.length + optionalFields.length + checkboxes.length;

      // 检查必填字段
      requiredFields.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (field.value.trim() && validateField(field)) {
          completed++;
        }
      });

      // 检查可选字段
      optionalFields.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (field.value.trim()) {
          completed++;
        }
      });

      // 检查复选框
      checkboxes.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (field.checked) {
          completed++;
        }
      });

      const progress = (completed / total) * 100;
      document.getElementById('progressFill').style.width = progress + '%';

      // 检查表单是否可以提交
      const canSubmit = requiredFields.every(fieldName => {
        const field = document.getElementById(fieldName);
        return field.value.trim() && validateField(field);
      }) && document.getElementById('terms').checked;

      document.getElementById('submitBtn').disabled = !canSubmit;
    }

    // 更新字符计数
    function updateCharCount(textarea) {
      const current = textarea.value.length;
      const max = textarea.maxLength;
      document.getElementById('charCount').textContent = `${current}/${max}`;
    }

    // 显示模态框
    function showTerms() {
      document.getElementById('termsModal').style.display = 'block';
    }

    function showPrivacy() {
      document.getElementById('privacyModal').style.display = 'block';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // 表单提交处理 - 中等复杂度 (复杂度: 8)
    document.getElementById('registrationForm').addEventListener('submit', function (e) {
      e.preventDefault();

      // 验证所有字段
      let isValid = true;
      const requiredFields = ['username', 'email', 'password', 'confirmPassword'];

      requiredFields.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (!validateField(field)) {
          isValid = false;
        }
      });

      // 验证年龄
      const birthDate = document.getElementById('birthDate').value;
      if (birthDate && !validateAge(birthDate)) {
        isValid = false;
      }

      // 验证服务条款
      if (!document.getElementById('terms').checked) {
        document.getElementById('termsError').textContent = '必须同意服务条款';
        isValid = false;
      }

      if (isValid) {
        // 模拟提交
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.textContent = '注册中...';
        submitBtn.disabled = true;

        setTimeout(() => {
          alert('注册成功！');
          submitBtn.textContent = '注册';
          this.reset();
          updateProgress();
        }, 2000);
      }
    });

    // 点击模态框外部关闭
    window.addEventListener('click', function (event) {
      const modals = ['termsModal', 'privacyModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    });

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function () {
      updateProgress();
    });
  </script>
</body>

</html>